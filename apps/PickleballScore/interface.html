<html>
  <head>
    <link rel="stylesheet" href="../../css/spectre.min.css" />
  </head>
  <body>
    <div>Http DATA</div>
    <div id='httpData'></div>
    <div>Fetch DATA</div>
    <div id='fetchData'></div>
    <div>CSV DATA</div>
    <div id="data"></div>
    <button class="btn btn-default" id="btnSave">Save</button>
    <button class="btn btn-default" id="btnDelete">Delete</button>
    <br></br>
    <button class="btn btn-default" >
      <a id='sendData'>
      click to send data to desk
      </a>
    </button>

    <script src="../../core/lib/interface.js"></script>
    <script>
      var dataElement = document.getElementById("data");
      var httpElement = document.getElementById("httpData");
      var fetchElement = document.getElementById("fetchData");
      var csvData = "";

      function httpGetData(){
        const Http = new XMLHttpRequest();
        const url = 'https://jsonplaceholder.typicode.com/posts';
        // const url = 'https://evening-springs-78435.herokuapp.com/events';
        Http.open("GET",url);
        Http.send()
        Http.onreadystatechange = (e) => {
          console.log('http get request starting...')
          // console.log(Http.responseText)
            httpElement.innerHTML = Http.responseText[0];
        }
        
      }

      function fetchGetData(){
        var requestOptions = {
          method: 'GET',
          redirect: 'follow'
        };

        fetch("https://jsonplaceholder.typicode.com/posts", requestOptions)
          .then(response => response.text())
          .then(console.log('fetch get request starting...'))
          .then(response => fetchElement.innerHTML=response.text())
          .then(result => console.log(result))
          // .then(result => fetchElement.innerHTML = result)
          .catch(error => console.log('error', error));
      }

      function getData() {
        // show loading window
        Util.showModal("Loading...");
        // get the data
        dataElement.innerHTML = "";
        Util.readStorageFile(`matchHistory.csv`, (data) => {
          csvData = data.trim();
          // remove window
          Util.hideModal();
          // If no data, report it and exit
          if (data.length == 0) {
            dataElement.innerHTML = "<b>No data found</b>";
            return;
          }
          // Otherwise parse the data and output it as a table
          dataElement.innerHTML =
            `<table>
    <tr>
      <th>GameStarted</th>
      <th>T1Score</th>
      <th>T2Score</th>
      <th>ServerVar</th>
      <th>T1Server</th>
      <th>T2Server</th>
      <th>action</th>
      <th>logCounter</th>

    </tr>` +
            data
              .trim()
              .split("\n")
              .map((l) => {
                l = l.split(",");
                return `<tr>
      <td>${l[0]}</td>
      <td>${l[1]}</td>
      <td>${l[2]}</td>
      <td>${l[3]}</td>
      <td>${l[4]}</td>
      <td>${l[5]}</td>
      <td>${l[6]}</td>
      <td>${l[7]}</td>
      </tr>`;
              })
              .join("\n") +
            "</table>";
        });
      }

      // You can call a utility function to save the data
      window.addEventListener("load", (event) => {
        Util.saveCSV("matchHistory", csvData);
      });
      // Or you can also delete the file
      document
        .getElementById("btnDelete")
        .addEventListener("click", function () {
          Util.showModal("Deleting...");
          Util.eraseStorageFile("matchHistory.csv", function () {
            Util.hideModal();
            getData();
          });
        });
      // Called when app starts
      function onInit() {
        getData();
        httpGetData();
        fetchGetData();
      }
    </script>
  </body>
</html>
